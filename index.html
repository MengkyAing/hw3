<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pro CRUD: Storage & Search</title>
    <style>
        :root {
            --primary: #3f51b5;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
            --bg: #f0f2f5;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; color: var(--primary); }

        /* Controls Section */
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .search-bar { flex-grow: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .clear-btn { background: var(--danger); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        /* Form Styling */
        #user-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #eee; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; }
        .btn-add { background: var(--success); }
        .btn-cancel { background: #9e9e9e; display: none; }

        /* Card Grid */
        #user-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border: 1px solid #ddd; padding: 20px; border-radius: 10px; position: relative; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        
        .price-tag { color: var(--success); font-weight: bold; }
        .discount-badge { background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-left: 5px; }
        
        .actions { margin-top: 15px; display: flex; gap: 10px; }
        .edit-btn { background: var(--warning); flex: 1; }
        .delete-btn { background: var(--danger); flex: 1; }
    </style>
</head>
<body>

<div class="container">
    <h1>User & Order Manager</h1>

    <form id="user-form">
        <input type="hidden" id="user-id">
        <input type="text" id="name-input" placeholder="Name" required>
        <input type="email" id="email-input" placeholder="Email" required>
        <input type="number" id="price-input" placeholder="Order Price ($)" required>
        <button type="submit" id="submit-button" class="btn btn-add">Add Record</button>
        <button type="button" id="cancel-button" class="btn btn-cancel">Cancel</button>
    </form>

    <div class="controls">
        <input type="text" id="search-input" class="search-bar" placeholder="Search by name or email...">
        <button id="clear-storage" class="clear-btn">Clear All Data</button>
    </div>

    <div id="user-list"></div>
</div>

<script>
    // --- DATA INITIALIZATION ---
    // Load from Local Storage OR use default if empty
    let users = JSON.parse(localStorage.getItem('crud_data')) || [
        
    ];
    let nextId = parseInt(localStorage.getItem('crud_nextId')) || 3;

    const userList = document.getElementById('user-list');
    const userForm = document.getElementById('user-form');
    const searchInput = document.getElementById('search-input');

    // --- DISCOUNT LOGIC ---
    function getFinalPrice(price) {
        if (price >= 1000) {
            return { final: price * 0.8, discounted: true }; // 20% off
        }
        return { final: price, discounted: false };
    }

    // --- LOCAL STORAGE FUNCTIONS ---
    function syncStorage() {
        localStorage.setItem('crud_data', JSON.stringify(users));
        localStorage.setItem('crud_nextId', nextId.toString());
    }

    // --- RENDER FUNCTION (With Filter Support) ---
    function render(filter = "") {
        userList.innerHTML = '';
        const filtered = users.filter(u => 
            u.name.toLowerCase().includes(filter.toLowerCase()) || 
            u.email.toLowerCase().includes(filter.toLowerCase())
        );

        filtered.forEach(user => {
            const pricing = getFinalPrice(user.price);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <h3>${user.name}</h3>
                <p>${user.email}</p>
                <p class="price-tag">
                    Price: $${pricing.final.toFixed(2)}
                    ${pricing.discounted ? '<span class="discount-badge">20% Off Applied</span>' : ''}
                </p>
                <div class="actions">
                    <button class="btn edit-btn" onclick="prepareEdit(${user.id})">Edit</button>
                    <button class="btn delete-btn" onclick="deleteUser(${user.id})">Delete</button>
                </div>
            `;
            userList.appendChild(card);
        });
    }

    // --- CREATE / UPDATE ---
    userForm.onsubmit = (e) => {
        e.preventDefault();
        const id = document.getElementById('user-id').value;
        const name = document.getElementById('name-input').value;
        const email = document.getElementById('email-input').value;
        const price = parseFloat(document.getElementById('price-input').value);

        if (id) {
            // Update
            const index = users.findIndex(u => u.id == id);
            users[index] = { id: parseInt(id), name, email, price };
        } else {
            // Create
            users.push({ id: nextId++, name, email, price });
        }

        syncStorage();
        resetForm();
        render();
    };

    // --- DELETE ---
    function deleteUser(id) {
        if (confirm("Delete this record?")) {
            users = users.filter(u => u.id !== id);
            syncStorage();
            render();
        }
    }

    // --- EDIT PREP ---
    function prepareEdit(id) {
        const user = users.find(u => u.id === id);
        document.getElementById('user-id').value = user.id;
        document.getElementById('name-input').value = user.name;
        document.getElementById('email-input').value = user.email;
        document.getElementById('price-input').value = user.price;
        
        document.getElementById('submit-button').innerText = "Update Record";
        document.getElementById('cancel-button').style.display = "inline-block";
    }

    // --- RESET & SEARCH & CLEAR ---
    function resetForm() {
        userForm.reset();
        document.getElementById('user-id').value = '';
        document.getElementById('submit-button').innerText = "Add Record";
        document.getElementById('cancel-button').style.display = "none";
    }

    searchInput.oninput = (e) => render(e.target.value);

    document.getElementById('cancel-button').onclick = resetForm;

    document.getElementById('clear-storage').onclick = () => {
        if (confirm("This will delete ALL data from local storage. Proceed?")) {
            localStorage.clear();
            users = [];
            nextId = 1;
            render();
        }
    };

    // Initial Load
    render();
</script>

</body>
</html>